"use strict";Aero.view.admin={guideid:"",type:"",render:function(e,o,a){$q(".container-close").remove(),this.type=e,Aero.tip._guide&&Aero.tip.hide(),$q(".aero-active").removeClass("aero-active"),Aero.tpl.get("sidebar-"+this.type+"-admin.html",function(a){$q(".aero-admin-wrapper").remove();var r=_q.template(a);$q("body").append(r({model:o})),$q("#aero-tab").css("left","-542px"),$q(".aero-sidebar").prepend('<div class="aero-blanket" style="display:none"></div>'),$q(".aero-blanket").fadeTo(300,.9,function(){}),"step"==e&&$q(".aero-nav-item:not(:first)").append('<a class="aero-del-nav">X</a>'),$q("#aeroEditor").trumbowyg({removeformatPasted:!0,fullscreenable:!1,resetCss:!0,autogrow:!0,height:100})}),setTimeout("$q('.aero-required:eq(0)').focus();",300),a&&$q(a).trigger("click")},renderMenu:function(e){var o=$q(".aero-strip-menu li").index(e);if($q(".aero-admin-body .open").removeClass("open"),$q(".aero-strip-menu li").removeClass("aero-menu-active"),e.addClass("aero-menu-active"),$q("#aeroSection"+o).addClass("open"),2==o&&"guide"==this.type&&Aero.view.guide.admin.renderRoles(),1==o&&"guide"==this.type&&Aero.view.guide.admin.renderPathways(),4==o&&"step"==this.type){"INPUT"!=$q($q("input[name='aero_loc']").val()).prop("tagName")&&$q('input[name="aero_mask"]').attr("disabled",!0).addClass("aero-disabled")}5!=o||"step"!=this.type||$q("#aeroBranch").data("multi-init")||$q("#aeroBranch").multiSelect({onChange:function(e){e>0?$q(".aero-branch-step").show():$q(".aero-branch-step").hide()}})},renderMenuTip:function(e,o){var a=$q('<div class="aero-menu-tip" style="top:-200px"><span></span>'+o+"</div>"),r=e.offset().top+a.outerHeight()/2+16;$q(".aero-app").append(a),a.css({top:r-$q(window).scrollTop(),left:55,opacity:0}),a.animate({opacity:1,left:"+=8"},100)},close:function(){var e=!$q(".aero-editing-step").hasClass("aero-add-step");if($q(".aero-admin-wrapper, .aero-edit-active").remove(),$q("#aero-tab").css("left","-44px"),$q(".aero-blanket").fadeTo("medium",0,function(){$q(this).remove()}),$q(".aero-editing").removeClass("aero-editing"),Aero.tip._guide&&e){var o=Aero.step.get(Aero.tip._current);Aero.tip.beforeShow(Aero.tip._current,o)}},edit:function(e,o){var a=!1,r=this,t=e.parents("li:eq(0)"),i=Aero.tip._guide?"step":"guide";r.guideid=Aero.tip._guide?Aero.tip._guide.id:e.parents("li:eq(0)").data("guideid"),t.addClass("aero-editing"),t.prepend('<span class="aero-edit-active"></span>'),Aero.guide.get(r.guideid,function(e){"step"==i&&((e=e.step[Aero.index]).id=r.guideid,e.index=Aero.index,e.isAdd=!1,o&&(e.loc=o,a=".aicon-loc")),Aero.view.admin.render(i,e,a)})},renderTools:function(e){var o=e.find(".aero-item-tools:eq(0)");if(o.length>0)o.show();else{var a=e.data("guideid")?"guide":"step",r=e.data("guideid")||Aero.tip._guide.id;Aero.tpl.get("sidebar-"+a+"-tools.html",function(o){Aero.model.guide.byId(r,function(a){var r=_q.template(o);e.prepend(r({creator:a.creator==Aero.constants.USERNAME}))})})}},setEvents:function(e){var o=this;e&&(o.type=e),$q("body").off("click.aeroCancel").on("click.aeroCancel",".aero-cancel-edit",function(){return o.close(),!1}).off("mouseenter.aerome").on("mouseenter.aerome",".aero-strip-menu a",function(){$q(".aero-menu-tip").remove(),Aero.view.admin.renderMenuTip($q(this),$q(this).data("title"))}).off("mouseleave.aeroml").on("mouseleave.aeroml",".aero-strip-menu a",function(){$q(".aero-menu-tip").remove()}).off("click.aeroTools").on("mouseenter.aeroTools",".aero-"+o.type+"s ul li",function(){return Aero.view.admin.renderTools($q(this)),!1}).off("click.aeroTools").on("mouseleave.aeroTools",".aero-"+o.type+"s ul li",function(){$q(".aero-item-tools").hide()}).off("change.aerob").on("change.aerob","select[name='aero_branch']",function(){$q('select[name="aero_return"]').parents("div:eq(0)").hide(),""!=$q(this).val()&&$q('select[name="aero_return"]').parents("div:eq(0)").show()})}};
"use strict";Aero.view.guide.admin={id:"",renderRoles:function(){this.renderMapping("roles")},renderPathways:function(){this.renderMapping("pathways")},renderMapping:function(e){Aero[e].getAll(function(i){$q(".aero-"+e).html("").append('<option value="">- Select a '+e.slice(0,-1)+" -</option>");for(var o in i)i.hasOwnProperty(o)&&$q(".aero-"+e).append('<option value="'+i[o].id+'">'+i[o].title+"</option>")}),Aero[e].getByGuideid(Aero.view.admin.guideid,function(i){$q(".aero-"+e+"-list ul").html("");for(var o in i)i.hasOwnProperty(o)&&$q(".aero-"+e+"-list ul").append('<li class="clearfix" data-id="'+i[o].id+'"><a class="aero-btn-grey"><i class="fa fa-times"></i></a><span>'+i[o].title+"</span></li>")})},save:function(){var e=Aero.view.admin.guideid,i=$q("#editGuideFrm").aeroSerialize();i.desc=$q("#aeroEditor").trumbowyg("html"),Aero.view.admin.close(),i.active="1"==i.active,i.auto="1"==i.auto||null,i.autoPage="1"==i.autoPage||null,""!=e?(i.id=e,Aero.guide.update(i)):Aero.guide.create(i,function(e){Aero.tip.start(e)})},setEvents:function(e){var i=this;$q("body").off("click.aeroGCreate").on("click.aeroGCreate","a.aero-btn-create",function(){return Aero.view.admin.guideid="",Aero.view.admin.render("guide",{}),!1}),$q("body").off("click.aeroSMenu").on("click.aeroSMenu",".aero-strip-menu a",function(){var e=$q(this).parents("li:eq(0)");return Aero.view.admin.renderMenu(e),!1}),$q("body").off("click.aeroGDelete").on("click.aeroGDelete",".aero-guides ul li a.aero-delete",function(){var e=$q(this).parents("li:eq(0)"),i=e.data("guideid"),o=e.find("a:last").text();return Aero.confirm({ok:AeroStep.lang.del,title:o,msg:AeroStep.lang.guidedelconf,onConfirm:function(){Aero.guide.destroy(i)}}),!1}),$q("body").off("click.aeroGEdit").on("click.aeroGEdit",".aero-guides ul li a.aero-edit",function(){return Aero.view.admin.edit($q(this)),!1}),$q("body").off("keypress.gsa").on("keypress.gsa","#editGuideFrm input",function(e){if("13"==(e.keyCode||e.which))return Aero.model.guide.validate()&&i.save(),!1}),$q("body").off("click.aeroGSave").on("click.aeroGSave",".aero-editing-guide .aero-btn-save",function(){if(Aero.model.guide.validate())return i.save(),!1}),$q("body").off("click.apA").on("click.apA",".aero-pathways-search a",function(){var e=$q(".aero-pathways").val();return""!=e&&Aero.pathways.createMapping(e,Aero.view.admin.guideid),!1}),$q("body").off("click.dpA").on("click.dpA",".aero-pathways-list a",function(){var e=$q(this).parent().data("id");return Aero.confirm({ok:"unlink",title:"Removing pathway link",msg:"Are you sure you want to remove this pathway?",onConfirm:function(){return Aero.pathways.destroyMapping(e,Aero.view.admin.guideid),!1}}),!1}),$q("body").off("click.arA").on("click.arA",".aero-roles-search a",function(){var e=$q(".aero-roles").val();return""!=e&&Aero.roles.createMapping(e,Aero.view.admin.guideid),!1}),$q("body").off("click.arcs").on("click.arcs",".aero-section input[name='aero_isRestrict']",function(){$q(".aero-color-wrapper").hide(),$q(this).is(":checked")&&$q(".aero-color-wrapper").show()}),$q("body").off("click.drA").on("click.drA",".aero-roles-list a",function(){var e=$q(this).parent().data("id");return Aero.confirm({ok:"unlink",title:"Removing role link",msg:"Are you sure you want to remove this role?",onConfirm:function(){return Aero.roles.destroyMapping(e,Aero.view.admin.guideid),!1}}),!1})}};
"use strict";Aero.view.step.admin={addNav:function(){$q(".aero-nav-item:first").clone().append('<a class="aero-del-nav">X</a>').insertAfter(".aero-nav-item:last")},destroyNav:function(e){$q(".aero-nav-item")&&e.parents(".aero-nav-item").remove()},save:function(){var e=parseInt($q(".aero-step-index").val()),o=$q("#editStepFrm").aeroSerialize();o.id=Aero.view.admin.guideid,o.body=$q("#aeroEditor").trumbowyg("html"),o.nav={},o.branch=""!=$q("#aeroBranch").val()?$q("#aeroBranch").val():null,Aero.host!=location.protocol+"//"+window.location.host&&(o.cds=location.protocol+"//"+window.location.host),""==o.size_custom||isNaN(o.size_custom+"")||(o.size=o.size_custom+""),delete o.size_custom;var t=Aero.view.step.admin.quiz.collectAnswers();o.answers=t.length>0?t:null,$q(".aero_nav_when").each(function(){""!=$q(this).val()&&(o.nav[$q(this).val()]=$q(this).parent().find(".aero_nav_to").val())}),0==o.nav.length&&delete o.nav,o.hide&&(o[o.hide]=!0,delete o.hide),o.showTitle="1"==o.showTitle||null,o.sidebar="1"==o.sidebar||null,o.multi="1"==o.multi||null,o.isRestrict="1"==o.isRestrict||null,o.spotlight="1"==o.spotlight||null,o=_q.pick(o,_q.identity),$q(".aero-editing-step").hasClass("aero-add-step")?(Aero.step.add(o),$q(".aero-helper").remove()):Aero.step.update(e,o),Aero.view.admin.close()},autoAdd:function(e){var o=this.setDefaults(e);""==o.title&&(o.title="Step "+(o.index+1)),""==o.body&&(o.body="Step Body"),Aero.step.add(o,function(){},!0)},setDefaults:function(e){var o=Aero.tip._guide.step.length>0?Aero.tip._current+1:0,t=[],a="",r="",i="",n=$q(e).prop("tagName").toLowerCase(),s=["button","a"];if($q.inArray(n,s)>-1&&(r="Click "+(i=$q.trim($q(e).text())),a=i,t={click:"-1"}),s=["input","select","textarea"],$q.inArray(n,s)>-1){i=$q.trim($q(e).parent().find("label:eq(0)").text());var l=$q("label[for='"+$q(e).attr("id")+"']");l.length>0&&(i=l.text().replace("*","")),r="Enter "+i,a=i,t={blur:"-1"}}var c=document.URL,d=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");if(!(c=c.replace(d,"")).match(/#\/$/)){c=c.replace(/(\/$|\/#$|#$)/,"")}if("a"==n){var u=$q(e).attr("href");"javascript://"!=u&&"#"!=u&&(t={unload:-1})}return{id:null,title:a,body:r,url:c,isAdd:!0,index:o,loc:e,nav:t,noUrl:0==o?"":"all",loss:"ignore",showTitle:!0}},initPicker:function(e){var o=this;Aero.picker.init({onStart:function(){Aero.tip.hide(),Aero.view.sidebar.hide()},callback:function(t){Aero.view.sidebar.show(!1,0),Aero.picker.destroy();var a=o.setDefaults(t);e?($q(".aero-editing").addClass("aero-picking").data("loc",a.loc),$q(".aero-picking a:eq(1)").trigger("click"),$q(".aero-picking").removeClass(".aero-picking")):Aero.view.admin.render("step",$q.extend(Aero.model.step.defaults(),a))}}),Aero.picker.setEvents()},renderSortable:function(){$q(".aero-steps ul").sortable({placeholder:"aero-helper-dropable",update:function(e,o){Aero.step.moveIndex(Aero.moveFrom,o.item.index()),Aero.moveFrom=null},start:function(e,o){Aero.moveFrom=o.item.index()}}).disableSelection()},setEvents:function(){var e=this;Aero.view.step.record.setEvents(),$q("body").off("click.aroSD").on("click.aroSD",".aero-steps ul li a.aero-delete",function(){var e=$q(".aero-steps li").index($q(this).parents("li:eq(0)"));return Aero.confirm({ok:AeroStep.lang.del,title:AeroStep.lang.stepdel,msg:AeroStep.lang.stepdelconf,onConfirm:function(){Aero.step.destroy(e)}}),!1}),$q("body").off("click.aeroLocE").on("click.aeroLocE","a.aero-edit-loc",function(){return Aero.view.step.admin.initPicker(!0),!1}),$q("body").off("click.aeroSEdit").on("click.aeroSEdit",".aero-steps ul li a.aero-edit",function(){var e=$q(this).parents("li:eq(0)"),o=!!e.data("loc")&&e.data("loc");return Aero.index=$q(".aero-steps li").index(e),Aero.view.admin.edit($q(this),o),!1}),$q("body").off("keypress.ssa").on("keypress.ssa","#editStepFrm input:not(.aero-input-label)",function(o){if("13"==(o.keyCode||o.which))return Aero.model.step.validate()&&e.save(),!1}),$q("body").off("click.aeroSSave").on("click.aeroSSave",".aero-editing-step .aero-btn-save",function(){if(Aero.model.step.validate())return e.save(),!1}),$q("body").off("click.aeroTab").on("click.aeroTab",".aero-tab a",function(){var e="aero-tab-active",o=$q(this).parents(".aero-section");return o.find("."+e).removeClass(e),o.find($q(this).attr("href")).addClass(e),$q(this).addClass(e),"aero-section-quiz"==$q(this).attr("id")&&Aero.view.step.admin.quiz.render(),!1}),$q("body").off("click.aeroNAdd").on("click.aeroNAdd",".aero-editing-step .aero-add-nav",function(){return e.addNav(),!1}),$q("body").off("click.aeroNDel").on("click.aeroNDel",".aero-editing-step .aero-del-nav",function(){return e.destroyNav($q(this)),!1}),$q("body").off("change.ssC").on("change.ssC",".aero-section select[name='aero_size']",function(){$q(".aero-custom-size").hide(),$q(".aero-custom-size input").val(""),"custom"==$q(this).val()&&$q(".aero-custom-size").show()}),$q("body").off("change.seC").on("change.seC",".aero-section select[name='aero_miss']",function(){$q(".aero-alert-edit, .aero-skip-edit").hide(),$q('input[name="aero_alert"], input[name="aero_alertContent"]').val(""),"alert"==$q(this).val()&&$q(".aero-alert-edit").show(),"skipto"==$q(this).val()&&$q(".aero-skip-edit").show()}),$q("body").off("change.seL").on("change.seL",".aero-section select[name='aero_loss']",function(){$q(".aero-loss-alert-edit, .aero-loss-skip-edit").hide(),$q('input[name="aero_lossalert"], input[name="aero_lossalertContent"]').val(""),"alert"==$q(this).val()&&$q(".aero-loss-alert-edit").show(),"skipto"==$q(this).val()&&$q(".aero-loss-skip-edit").show()}),$q("body").off("change.lut").on("change.lut",".aero-section input[name='aero_locText']",function(){var e,o,t,a,r;e=$q("input[name='aero_loc']").val(),"A"!=(a=(t=$q(e)).prop("tagName"))&&"BUTTON"!=a&&"LABEL"!=a||(r=(r=e.split(">")).slice(0,-1),o=$q(this).is(":checked")?r.join(">")+"> "+a.toLowerCase()+":contains('"+t.text().trim()+"')":r.join(">")+"> "+a.toLowerCase()+":eq("+$q(r.join(">")+"> "+a.toLowerCase()).index(t)+")",$q("input[name='aero_loc']").val(o))}),$q("body").on("mouseup","a.aero-btn-picker",function(){$q(".aero-play").remove(),e.initPicker()}).on("click","a.aero-btn-picker",function(){return!1})}},Aero.view.step.record={init:function(e){var o=Aero.picker.get(e);Aero.view.step.admin.autoAdd(o),$q(".aero-tip").remove()},on:function(e){var o=this;Aero.tip._guide&&(aeroStorage.setItem("aero:session:recording",1),$q(".aero-btn-record span:eq(0)").addClass("recording"),Aero.log("Started Recording...","warn"),e||$q(".aero-play").fadeOut(500,function(){$q(".aero-play").remove()}),$q(".aero-tip").remove(),$q("body").off("mousedown.autorc").on("mousedown.autorc",function(e){o.init(e)}),$q("body").off("input.autori,textarea.autort").on("focus","input.autori,textarea.autort",function(e){o.init(e)}),$q("body").on("mousedown.side",".aero-modal, .aero-tip, .aero-app, .ae-active-el, .aero-play",function(e){e.stopPropagation()}))},off:function(){Aero.log("Stopped Recording.","success"),aeroStorage.removeItem("aero:session:recording"),$q(".aero-btn-record span:eq(0)").removeClass("recording"),$q("body").off("mousedown.autorc input.autori textarea.autort")},setEvents:function(){var e=this;$q("body").off("click.aerec").on("click.aerec",".aero-btn-record",function(){aeroStorage.getItem("aero:session:recording")?e.off():e.on()})}};
"use strict";Aero.pathways={getAll:function(a){Aero.constants.PATHWAYS?a(Aero.constants.PATHWAYS):Aero.send("api/pathway",{},function(i){Aero.constants.PATHWAYS=i,a(i)},"GET")},getByGuideid:function(a,i){Aero.send("api/pathwaymap/by_guide",{guideid:a},function(a){i(a)},"GET")},createMapping:function(a,i){Aero.send("api/pathwaymap",{guideid:i,pathwayid:a},function(){Aero.view.guide.admin.renderMapping("pathways")},"POST")},destroyMapping:function(a,i){Aero.send("api/pathwaymap",{guideid:i,pathwayid:a},function(){Aero.view.guide.admin.renderMapping("pathways")},"DELETE")}};
"use strict";Aero.roles={getAll:function(e){Aero.constants.ROLES?e(Aero.constants.ROLES):Aero.send("api/role",{},function(i){Aero.constants.ROLES=i,e(i)},"GET")},getByGuideid:function(e,i){Aero.send("api/rolemap/by_guide",{guideid:e},function(e){i(e)},"GET")},createMapping:function(e,i){Aero.send("api/rolemap",{guideid:i,roleid:e},function(){Aero.view.guide.admin.renderMapping("roles")},"POST")},destroyMapping:function(e,i){Aero.send("api/rolemap",{guideid:i,roleid:e},function(){Aero.view.guide.admin.renderMapping("roles")},"DELETE")}};
"use strict";Aero.picker={options:{onStart:function(){Aero.log("Starting picker","info")},callback:function(e){Aero.log("Starting picker path:"+e,"info")}},init:function(e){var t=this,o=$q(".aero-picker"),n=$q.extend({},this.options,e);n.onStart(),0==o.length&&(o=$q('<div class="aero-picker" style="border:0.2em dashed #0599c3; position: fixed; top: 0; left: 0; height: 100%; width: 100%; z-index:999999999999;"></div>'),$q("body").append(o),o.on("mousemove.aeroPicker",function(e){t.latch(e)}).on("mousedown.aeroPicker",function(e){n.callback(t.get(e))}))},destroy:function(){$q(".aero-picker").remove(),$q("*").off(".aeroPicker")},latch:function(e){var t=this.getElementByPos(e.pageX,e.pageY);if(t.length>0){var o=!1,n=$q(".aero-picker"),r=this.scrollOffset(t),i=r.top,c=r.left,a=t.outerHeight(),s=t.outerWidth();if("IFRAME"==t.prop("tagName")){o=!0;var l=t.get(0),f=t.contentWindow?l.contentWindow:l.contentDocument.defaultView,u=$q(f.document.elementFromPoint(e.pageX-c,e.pageY-i)),p=u.offset()}t.trigger("mouseover"),t.trigger("mouseenter"),o&&(i+=p.top,c+=p.left,a=u.outerHeight(),s=u.outerWidth()),a>0&&s>0&&n.css({height:a+"px",width:s+"px",top:i+"px",left:c+"px"})}},get:function(e){return this.getElementByPos(e.pageX,e.pageY).getSelector({ignore:{classes:["ae-active-el"]}})[0]},getElementByPos:function(e,t){$q(".aero-picker").hide(),e-=$q(document).scrollLeft(),t-=$q(document).scrollTop();var o=document.elementFromPoint(e,t);return $q(".aero-picker").show(),$q(o)},scrollOffset:function(e){var t=e.offset();return t.top-=$q(document).scrollTop(),t.left-=$q(document).scrollLeft(),t},setEvents:function(){var e=this;$q("body").on("mousemove.aeroPicker","*",function(t){e.latch(t)}),$q(document).keyup(function(t){27==t.keyCode&&(e.destroy(),Aero.view.sidebar.show(!1,0))})}};
"use strict";Aero.view.step.admin.quiz={render:function(){this.setEvents()},renderAnswer:function(e,a){if(""!=e.title){var r='<li class="clearfix"><a class="aero-btn-grey aero-answer-delete"><i class="fa fa-times"></i></a><a class="aero-btn-grey aero-answer-check '+(e.correct?"aero-checked":"")+'"><i class="fa '+(e.correct?"fa-check-square-o":"fa-square-o")+'"></i></a><span>'+e.title+"</span></li>";if(a)return r;$q(".aero-answer-list ul").append($q(r)),$q(".aero-answer").val("")}},collectAnswers:function(){var e=[];return $q(".aero-answer-list li").each(function(){var a={title:$q(this).find("span").text(),correct:$q(this).find(".aero-answer-check").hasClass("aero-checked")};e.push(a)}),e},setEvents:function(){var e=this;$q(".aero-answer-list ul").sortable(),$q("body").off("click.qaa").on("click.qaa",".aero-answer-check",function(){var e=$q(this).find("i");e.hasClass("fa-square-o")?($q(this).addClass("aero-checked"),e.attr("class",e.attr("class").replace("-square","-check-square"))):($q(this).removeClass("aero-checked"),e.attr("class",e.attr("class").replace("-check-square","-square")))}),$q("body").off("keydown.qkp").on("keydown.qkp",".aero-answer",function(a){if("13"==(a.keyCode?a.keyCode:a.which)){var r={title:$q(this).val(),correct:!1};return e.renderAnswer(r),!1}}),$q("body").off("click.qaaz").on("click.qaaz",".aero-answer-add",function(){var a={title:$q(".aero-answer").val(),correct:!1};e.renderAnswer(a)}),$q("body").off("click.qd").on("click.qd",".aero-answer-delete",function(e){$q(this).parents("li:eq(0)").remove()})}};
"use strict";function AeroAdminMain(){AeroStep.admin&&(Aero.view.admin.setEvents("step"),Aero.view.admin.setEvents("guide"),Aero.view.step.admin.setEvents(),Aero.view.guide.admin.setEvents()),$q(document).keyup(function(e){192==e.keyCode&&event.shiftKey&&Aero.view.step.admin.initPicker()}),aeroStorage.getItem("aero:session:recording")&&Aero.view.step.record.on()}AeroAdminMain();