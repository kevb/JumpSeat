"use strict";Aero.view.step.admin={addNav:function(){$q(".aero-nav-item:first").clone().append('<a class="aero-del-nav">X</a>').insertAfter(".aero-nav-item:last")},destroyNav:function(e){$q(".aero-nav-item")&&e.parents(".aero-nav-item").remove()},save:function(){var e=parseInt($q(".aero-step-index").val()),o=$q("#editStepFrm").aeroSerialize();o.id=Aero.view.admin.guideid,o.body=$q("#aeroEditor").trumbowyg("html"),o.nav={},o.branch=""!=$q("#aeroBranch").val()?$q("#aeroBranch").val():null,Aero.host!=location.protocol+"//"+window.location.host&&(o.cds=location.protocol+"//"+window.location.host),""==o.size_custom||isNaN(o.size_custom+"")||(o.size=o.size_custom+""),delete o.size_custom;var t=Aero.view.step.admin.quiz.collectAnswers();o.answers=t.length>0?t:null,$q(".aero_nav_when").each(function(){""!=$q(this).val()&&(o.nav[$q(this).val()]=$q(this).parent().find(".aero_nav_to").val())}),0==o.nav.length&&delete o.nav,o.hide&&(o[o.hide]=!0,delete o.hide),o.showTitle="1"==o.showTitle||null,o.sidebar="1"==o.sidebar||null,o.multi="1"==o.multi||null,o.isRestrict="1"==o.isRestrict||null,o.spotlight="1"==o.spotlight||null,o=_q.pick(o,_q.identity),$q(".aero-editing-step").hasClass("aero-add-step")?(Aero.step.add(o),$q(".aero-helper").remove()):Aero.step.update(e,o),Aero.view.admin.close()},autoAdd:function(e){var o=this.setDefaults(e);""==o.title&&(o.title="Step "+(o.index+1)),""==o.body&&(o.body="Step Body"),Aero.step.add(o,function(){},!0)},setDefaults:function(e){var o=Aero.tip._guide.step.length>0?Aero.tip._current+1:0,t=[],a="",r="",i="",n=$q(e).prop("tagName").toLowerCase(),s=["button","a"];if($q.inArray(n,s)>-1&&(r="Click "+(i=$q.trim($q(e).text())),a=i,t={click:"-1"}),s=["input","select","textarea"],$q.inArray(n,s)>-1){i=$q.trim($q(e).parent().find("label:eq(0)").text());var l=$q("label[for='"+$q(e).attr("id")+"']");l.length>0&&(i=l.text().replace("*","")),r="Enter "+i,a=i,t={blur:"-1"}}var c=document.URL,d=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");if(!(c=c.replace(d,"")).match(/#\/$/)){c=c.replace(/(\/$|\/#$|#$)/,"")}if("a"==n){var u=$q(e).attr("href");"javascript://"!=u&&"#"!=u&&(t={unload:-1})}return{id:null,title:a,body:r,url:c,isAdd:!0,index:o,loc:e,nav:t,noUrl:0==o?"":"all",loss:"ignore",showTitle:!0}},initPicker:function(e){var o=this;Aero.picker.init({onStart:function(){Aero.tip.hide(),Aero.view.sidebar.hide()},callback:function(t){Aero.view.sidebar.show(!1,0),Aero.picker.destroy();var a=o.setDefaults(t);e?($q(".aero-editing").addClass("aero-picking").data("loc",a.loc),$q(".aero-picking a:eq(1)").trigger("click"),$q(".aero-picking").removeClass(".aero-picking")):Aero.view.admin.render("step",$q.extend(Aero.model.step.defaults(),a))}}),Aero.picker.setEvents()},renderSortable:function(){$q(".aero-steps ul").sortable({placeholder:"aero-helper-dropable",update:function(e,o){Aero.step.moveIndex(Aero.moveFrom,o.item.index()),Aero.moveFrom=null},start:function(e,o){Aero.moveFrom=o.item.index()}}).disableSelection()},setEvents:function(){var e=this;Aero.view.step.record.setEvents(),$q("body").off("click.aroSD").on("click.aroSD",".aero-steps ul li a.aero-delete",function(){var e=$q(".aero-steps li").index($q(this).parents("li:eq(0)"));return Aero.confirm({ok:AeroStep.lang.del,title:AeroStep.lang.stepdel,msg:AeroStep.lang.stepdelconf,onConfirm:function(){Aero.step.destroy(e)}}),!1}),$q("body").off("click.aeroLocE").on("click.aeroLocE","a.aero-edit-loc",function(){return Aero.view.step.admin.initPicker(!0),!1}),$q("body").off("click.aeroSEdit").on("click.aeroSEdit",".aero-steps ul li a.aero-edit",function(){var e=$q(this).parents("li:eq(0)"),o=!!e.data("loc")&&e.data("loc");return Aero.index=$q(".aero-steps li").index(e),Aero.view.admin.edit($q(this),o),!1}),$q("body").off("keypress.ssa").on("keypress.ssa","#editStepFrm input:not(.aero-input-label)",function(o){if("13"==(o.keyCode||o.which))return Aero.model.step.validate()&&e.save(),!1}),$q("body").off("click.aeroSSave").on("click.aeroSSave",".aero-editing-step .aero-btn-save",function(){if(Aero.model.step.validate())return e.save(),!1}),$q("body").off("click.aeroTab").on("click.aeroTab",".aero-tab a",function(){var e="aero-tab-active",o=$q(this).parents(".aero-section");return o.find("."+e).removeClass(e),o.find($q(this).attr("href")).addClass(e),$q(this).addClass(e),"aero-section-quiz"==$q(this).attr("id")&&Aero.view.step.admin.quiz.render(),!1}),$q("body").off("click.aeroNAdd").on("click.aeroNAdd",".aero-editing-step .aero-add-nav",function(){return e.addNav(),!1}),$q("body").off("click.aeroNDel").on("click.aeroNDel",".aero-editing-step .aero-del-nav",function(){return e.destroyNav($q(this)),!1}),$q("body").off("change.ssC").on("change.ssC",".aero-section select[name='aero_size']",function(){$q(".aero-custom-size").hide(),$q(".aero-custom-size input").val(""),"custom"==$q(this).val()&&$q(".aero-custom-size").show()}),$q("body").off("change.seC").on("change.seC",".aero-section select[name='aero_miss']",function(){$q(".aero-alert-edit, .aero-skip-edit").hide(),$q('input[name="aero_alert"], input[name="aero_alertContent"]').val(""),"alert"==$q(this).val()&&$q(".aero-alert-edit").show(),"skipto"==$q(this).val()&&$q(".aero-skip-edit").show()}),$q("body").off("change.seL").on("change.seL",".aero-section select[name='aero_loss']",function(){$q(".aero-loss-alert-edit, .aero-loss-skip-edit").hide(),$q('input[name="aero_lossalert"], input[name="aero_lossalertContent"]').val(""),"alert"==$q(this).val()&&$q(".aero-loss-alert-edit").show(),"skipto"==$q(this).val()&&$q(".aero-loss-skip-edit").show()}),$q("body").off("change.lut").on("change.lut",".aero-section input[name='aero_locText']",function(){var e,o,t,a,r;e=$q("input[name='aero_loc']").val(),"A"!=(a=(t=$q(e)).prop("tagName"))&&"BUTTON"!=a&&"LABEL"!=a||(r=(r=e.split(">")).slice(0,-1),o=$q(this).is(":checked")?r.join(">")+"> "+a.toLowerCase()+":contains('"+t.text().trim()+"')":r.join(">")+"> "+a.toLowerCase()+":eq("+$q(r.join(">")+"> "+a.toLowerCase()).index(t)+")",$q("input[name='aero_loc']").val(o))}),$q("body").on("mouseup","a.aero-btn-picker",function(){$q(".aero-play").remove(),e.initPicker()}).on("click","a.aero-btn-picker",function(){return!1})}},Aero.view.step.record={init:function(e){var o=Aero.picker.get(e);Aero.view.step.admin.autoAdd(o),$q(".aero-tip").remove()},on:function(e){var o=this;Aero.tip._guide&&(aeroStorage.setItem("aero:session:recording",1),$q(".aero-btn-record span:eq(0)").addClass("recording"),Aero.log("Started Recording...","warn"),e||$q(".aero-play").fadeOut(500,function(){$q(".aero-play").remove()}),$q(".aero-tip").remove(),$q("body").off("mousedown.autorc").on("mousedown.autorc",function(e){o.init(e)}),$q("body").off("input.autori,textarea.autort").on("focus","input.autori,textarea.autort",function(e){o.init(e)}),$q("body").on("mousedown.side",".aero-modal, .aero-tip, .aero-app, .ae-active-el, .aero-play",function(e){e.stopPropagation()}))},off:function(){Aero.log("Stopped Recording.","success"),aeroStorage.removeItem("aero:session:recording"),$q(".aero-btn-record span:eq(0)").removeClass("recording"),$q("body").off("mousedown.autorc input.autori textarea.autort")},setEvents:function(){var e=this;$q("body").off("click.aerec").on("click.aerec",".aero-btn-record",function(){aeroStorage.getItem("aero:session:recording")?e.off():e.on()})}};